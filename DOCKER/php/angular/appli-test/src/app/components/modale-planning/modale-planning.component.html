<div class="modal-overlay">
  <div class="modal">
    <!-- HEADER FIXE -->
    <div class="modal-header">
      <h3 class="modal-title">Générer un planning</h3>
      <button type="button" class="close-button" (click)="onCancel()">✕</button>
    </div>

    <!-- BODY SCROLLABLE -->
    <div class="modal-body">
      <form class="form" [class.disabled-form]="isSubmitting">
        <!-- Nom -->
        <div class="input-wrapper">
          <label>Nom du planning* :</label>
          <input
            type="text"
            name="nom"
            [(ngModel)]="newPlanning.nom"
            (ngModelChange)="validateForm()"
          />
        </div>
        <div class="error-message" *ngIf="formErrors.nom">
          Le nom du planning est obligatoire.
        </div>

        <!-- Promo -->
        <div class="input-wrapper">
          <label>Promo étudiants* :</label>
          <select
            name="promo"
            [(ngModel)]="newPlanning.idAnneeFormation"
            (ngModelChange)="validateForm()"
          >
            <option [ngValue]="null">-- Sélectionner --</option>
            <option
              *ngFor="let promo of promos"
              [ngValue]="promo.idAnneeFormation"
            >
              {{ promo.libelle }}
            </option>
          </select>
        </div>
        <div class="error-message" *ngIf="formErrors.promo">
          La promo est obligatoire.
        </div>

        <!-- Dates -->
        <div class="line-wrapper">
          <div class="input-wrapper">
            <label>Début* :</label>
            <input
              type="date"
              name="dateDebut"
              [(ngModel)]="newPlanning.dateDebut"
              (ngModelChange)="validateForm()"
            />
          </div>

          <div class="input-wrapper">
            <label>Fin* :</label>
            <input
              type="date"
              name="dateFin"
              [(ngModel)]="newPlanning.dateFin"
              (ngModelChange)="validateForm()"
            />
          </div>
        </div>
        <div class="error-message" *ngIf="formErrors.date">
          {{ formErrors.date }}
        </div>

        <!-- Heures matin -->
        <div class="time-section">Matin</div>
        <div class="line-wrapper">
          <div class="input-wrapper">
            <label>Début* :</label>
            <input
              type="time"
              name="heureDebutMatin"
              [(ngModel)]="newPlanning.heureDebutMatin"
              (ngModelChange)="validateForm()"
            />
          </div>

          <div class="input-wrapper">
            <label>Fin* :</label>
            <input
              type="time"
              name="heureFinMatin"
              [(ngModel)]="newPlanning.heureFinMatin"
              (ngModelChange)="validateForm()"
            />
          </div>
        </div>

        <!-- Heures aprem -->
        <div class="time-section">Après-midi</div>
        <div class="line-wrapper">
          <div class="input-wrapper">
            <label>Début* :</label>
            <input
              type="time"
              name="heureDebutAprem"
              [(ngModel)]="newPlanning.heureDebutAprem"
              (ngModelChange)="validateForm()"
            />
          </div>

          <div class="input-wrapper">
            <label>Fin* :</label>
            <input
              type="time"
              name="heureFinAprem"
              [(ngModel)]="newPlanning.heureFinAprem"
              (ngModelChange)="validateForm()"
            />
          </div>
        </div>

        <div class="error-message" *ngIf="formErrors.time">
          {{ formErrors.time }}
        </div>

        <!-- Salles -->
        <div class="input-wrapper">
          <label>Salles disponibles* :</label>
          <div class="multi-select">
            <div class="select-box" (click)="toggleDropdown()">
              {{ selectedSallesText }}
              <span class="arrow"></span>
            </div>

            <div class="options" *ngIf="dropdownOpen">
              <label *ngFor="let salle of salles" class="option">
                <input
                  type="checkbox"
                  [checked]="selectedSalles.includes(salle)"
                  (change)="onSalleToggle($event, salle)"
                />
                <span class="option-text">{{ salle.nomSalle }}</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Durée -->
        <div class="input-wrapper">
          <label>Durée soutenance* :</label>
          <input
            type="number"
            name="duree"
            [(ngModel)]="newPlanning.dureeSoutenance"
            (ngModelChange)="validateForm()"
          />
          minutes
        </div>
        <div class="error-message" *ngIf="formErrors.duree">
          La durée est obligatoire.
        </div>
      </form>
    </div>

    <!-- FOOTER FIXE -->
    <div class="modal-footer">
      <button type="button" class="cancel-button" (click)="onCancel()">
        Annuler
      </button>
      <button
        class="generate-button"
        [disabled]="isSubmitting || !isFormValid"
        (click)="onSubmit()"
      >
        Générer
      </button>
    </div>
  </div>
</div>
