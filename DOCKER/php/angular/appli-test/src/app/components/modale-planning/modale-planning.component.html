<div class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Générer un planning</h3>
      <button type="button" class="close-button" (click)="onCancel()">✕</button>
    </div>

    <div class="modal-body">
      <form
        class="form"
        [formGroup]="planningForm"
        (ngSubmit)="onSubmit()"
        [class.disabled-form]="isSubmitting"
      >
        <!-- Nom -->
        <div class="input-wrapper">
          <label>Nom du planning* :</label>
          <input type="text" formControlName="nom" />
        </div>
        <div
          class="error-message"
          *ngIf="submitted && planningForm.get('nom')?.hasError('required')"
        >
          Le nom du planning est obligatoire.
        </div>

        <!-- Promo -->
        <div class="input-wrapper">
          <label>Promo étudiants* :</label>
          <select formControlName="idAnneeFormation">
            <option [ngValue]="null">-- Sélectionner --</option>
            <option
              *ngFor="let promo of promos"
              [ngValue]="promo.idAnneeFormation"
            >
              {{ promo.libelle }}
            </option>
          </select>
        </div>
        <div
          class="error-message"
          *ngIf="
            submitted &&
            planningForm.get('idAnneeFormation')?.hasError('required')
          "
        >
          La promo est obligatoire.
        </div>

        <!-- Dates -->
        <div class="line-wrapper">
          <div class="input-wrapper">
            <label>Début* :</label>
            <input type="date" formControlName="dateDebut" />
          </div>
          <div class="input-wrapper">
            <label>Fin* :</label>
            <input type="date" formControlName="dateFin" />
          </div>
        </div>
        <div
          class="error-message"
          *ngIf="
            submitted && planningForm.get('dateDebut')?.hasError('required')
          "
        >
          La date de début est obligatoire.
        </div>
        <div
          class="error-message"
          *ngIf="submitted && planningForm.get('dateFin')?.hasError('required')"
        >
          La date de fin est obligatoire.
        </div>
        <div class="error-message" *ngIf="planningForm.hasError('dateOrder')">
          La date de fin doit être postérieure à la date de début.
        </div>

        <!-- Matin -->
        <div class="time-section">Matin</div>
        <div class="line-wrapper">
          <div class="input-wrapper">
            <label>Début* :</label>
            <input type="time" formControlName="heureDebutMatin" />
          </div>
          <div class="input-wrapper">
            <label>Fin* :</label>
            <input type="time" formControlName="heureFinMatin" />
          </div>
        </div>
        <div
          class="error-message"
          *ngIf="
            submitted &&
            planningForm.get('heureDebutMatin')?.hasError('required')
          "
        >
          L'heure de début du matin est obligatoire.
        </div>
        <div
          class="error-message"
          *ngIf="
            submitted && planningForm.get('heureFinMatin')?.hasError('required')
          "
        >
          L'heure de fin du matin est obligatoire.
        </div>
        <div class="error-message" *ngIf="planningForm.hasError('matinOrder')">
          La fin du matin doit être après le début.
        </div>

        <!-- Aprem -->
        <div class="time-section">Après-midi</div>
        <div class="line-wrapper">
          <div class="input-wrapper">
            <label>Début* :</label>
            <input type="time" formControlName="heureDebutAprem" />
          </div>
          <div class="input-wrapper">
            <label>Fin* :</label>
            <input type="time" formControlName="heureFinAprem" />
          </div>
        </div>
        <div
          class="error-message"
          *ngIf="
            submitted &&
            planningForm.get('heureDebutAprem')?.hasError('required')
          "
        >
          L'heure de début de l'après-midi est obligatoire.
        </div>
        <div
          class="error-message"
          *ngIf="
            submitted && planningForm.get('heureFinAprem')?.hasError('required')
          "
        >
          L'heure de fin de l'après-midi est obligatoire.
        </div>
        <div class="error-message" *ngIf="planningForm.hasError('apremStart')">
          L'après-midi doit commencer après la fin du matin.
        </div>
        <div class="error-message" *ngIf="planningForm.hasError('apremOrder')">
          La fin de l'après-midi doit être après le début.
        </div>

        <!-- Salles -->
        <div class="input-wrapper">
          <label>Salles disponibles* :</label>

          <div class="multi-select">
            <div
              class="select-box"
              cdkOverlayOrigin
              #origin="cdkOverlayOrigin"
              (click)="dropdownOpen = !dropdownOpen"
            >
              {{ selectedSallesText }}
              <span class="arrow"></span>
            </div>

            <ng-template
              cdkConnectedOverlay
              [cdkConnectedOverlayOrigin]="origin"
              [cdkConnectedOverlayOpen]="dropdownOpen"
              [cdkConnectedOverlayHasBackdrop]="true"
              [cdkConnectedOverlayBackdropClass]="'transparent-backdrop'"
              (backdropClick)="dropdownOpen = false"
            >
              <div class="options">
                <label *ngFor="let salle of salles" class="option">
                  <input
                    type="checkbox"
                    [checked]="selectedSalles.includes(salle)"
                    (change)="onSalleToggle($event, salle)"
                  />
                  {{ salle.nomSalle }}
                </label>
              </div>
            </ng-template>
          </div>
        </div>

        <!-- Durée -->
        <div class="input-wrapper">
          <label>Durée soutenance* :</label>
          <input type="number" formControlName="dureeSoutenance" /> minutes
        </div>
        <div
          class="error-message"
          *ngIf="
            submitted &&
            planningForm.get('dureeSoutenance')?.hasError('required')
          "
        >
          La durée est obligatoire.
        </div>
      </form>
    </div>

    <!-- Btn -->
    <div class="modal-footer">
      <button type="button" class="cancel-button" (click)="onCancel()">
        Annuler
      </button>
      <button
        class="generate-button"
        [disabled]="isSubmitting"
        (click)="onSubmit()"
      >
        Générer
      </button>
    </div>
  </div>
</div>
